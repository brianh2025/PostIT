<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A4 åˆ—å°æ¨¡æ¿ (å«ä¸‹æ‹‰é¸å–®)</title>
    <!-- å¼•å…¥ Tailwind CSS ä»¥å¿«é€Ÿç¾åŒ–éåˆ—å°å…ƒç´  -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Google Fonts - Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* æ·ºç°è‰²èƒŒæ™¯ */
        }

        /* é‡å°åˆ—å°çš„æ¨£å¼ */
        @media print {
            /* éš±è—æ‰€æœ‰ä¸éœ€è¦åˆ—å°çš„å…ƒç´  */
            .no-print {
                display: none !important;
            }
            .print-only-name {
                display: inline-block !important;
            }

            /* ç¢ºä¿åˆ—å°é é¢æ²’æœ‰å¤šé¤˜çš„é‚Šè· */
            @page {
                size: A4;
                margin: 0;
            }

            body {
                margin: 0;
                padding: 0;
                background-color: #fff; /* åˆ—å°æ™‚èƒŒæ™¯ç‚ºç™½è‰² */
            }
            
            /* åˆ—å°æ™‚ï¼Œé é¢å®¹å™¨å¡«æ»¿æ•´å€‹é é¢ */
            .page-container {
                margin: 0;
                padding: 0;
                box-shadow: none;
                border: none;
            }
            
            /* åˆ—å°æ™‚ç§»é™¤æ ¼å­çš„å¤–æ¡†å’Œ placeholder */
            .grid-cell {
                color: #000 !important;
            }
            .grid-cell:focus-within {
                outline: none !important;
            }
        }

        /* A4 é é¢å®¹å™¨çš„æ¨£å¼ (ç”¨æ–¼é è¦½) */
        /* A4 å°ºå¯¸: 210mm x 297mm */
        .page-container {
            width: 210mm;
            height: 297mm;
            background-color: white;
            margin: 2rem auto; /* åœ¨è¢å¹•ä¸Šç½®ä¸­é¡¯ç¤º */
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            box-sizing: border-box; /* ç¢ºä¿ padding ä¸æœƒå¢åŠ å¯¬é«˜ */
            display: flex;
            flex-direction: column;
            align-items: center; /* æ°´å¹³ç½®ä¸­ç¶²æ ¼ */
            padding-top: 24pt;   /* ä¸Šé‚Šè· 2cm */
            padding-bottom: 24pt;/* ä¸‹é‚Šè· 2cm */
        }

        /* ç¶²æ ¼å®¹å™¨ */
        .grid-container {
            display: grid;
            /* 4 æ¬„ï¼Œæ¯æ¬„ 4.5cm */
            grid-template-columns: repeat(4, 4.5cm);
            /* 5 åˆ—ï¼Œæ¯åˆ— 5cm */
            grid-template-rows: repeat(5, 5cm);
            gap: 0; /* å„²å­˜æ ¼ä¹‹é–“æ²’æœ‰é–“è· */
            border-left: 1px solid #ccc; /* åŠ ä¸Šå·¦é‚Šæ¡†å’Œä¸Šé‚Šæ¡†ä»¥å½¢æˆå®Œæ•´ç¶²æ ¼ */
            border-top: 1px solid #ccc;
        }

        /* ç¶²æ ¼ä¸­çš„å„²å­˜æ ¼ */
        .grid-cell {
            width: 100%; /* å¯¬åº¦ç”± grid æ§åˆ¶ */
            height: 5cm;
            border-right: 1px solid #ccc; /* å„²å­˜æ ¼çš„å³é‚Šæ¡†å’Œä¸‹é‚Šæ¡† */
            border-bottom: 1px solid #ccc;
            box-sizing: border-box; /* ç¢ºä¿é‚Šæ¡†ä¸æœƒå¢åŠ å„²å­˜æ ¼å¤§å° */
            padding: 8px; /* å¢åŠ å…§é‚Šè· */
            overflow: hidden; /* é˜²æ­¢å…§å®¹æº¢å‡º */
            color: #1f2937; /* è¼¸å…¥çš„æ–‡å­—é¡è‰² */
            font-size: 14px;
            display: flex;
            flex-direction: column;
        }
        
        /* ç•¶é»æ“Šå„²å­˜æ ¼é€²è¡Œç·¨è¼¯æ™‚ï¼Œé¡¯ç¤ºè—è‰²å¤–æ¡† */
        .grid-cell:focus-within {
            outline: 2px solid #3b82f6;
            outline-offset: -2px; /* è®“å¤–æ¡†åœ¨æ ¼å­å…§éƒ¨ */
        }
        
        /* åˆä½µå¾Œçš„å„²å­˜æ ¼æ¨£å¼ (åƒ…ä½œç‚ºæ¨™è¨˜) */
        .merged-cell {
           /* å¯¦éš›çš„åˆä½µæ¨£å¼ç”± JavaScript å‹•æ…‹è¨­å®š */
        }

        .cell-header {
            flex-shrink: 0;
            margin-bottom: 4px;
        }

        .personnel-select {
            border: none;
            border-bottom: 1px solid #000;
            background: transparent;
            padding: 0 4px;
            font-size: 14px;
        }
        .personnel-select:focus {
            outline: none;
        }

        .print-only-name {
            display: none; /* è¢å¹•ä¸Šéš±è— */
            min-width: 100px; /* çµ¦äºˆè¶³å¤ å¯¬åº¦ */
            border-bottom: 1px solid #000;
            text-align: center;
            padding: 0 4px;
        }

        .editable-content {
            flex-grow: 1;
            word-wrap: break-word;
        }
        .editable-content:focus {
            outline: none;
        }
        .editable-content:empty::before {
            content: 'åœ¨æ­¤è¼¸å…¥å…§å®¹...';
            color: #9ca3af;
            pointer-events: none;
        }

    </style>
</head>
<body class="bg-gray-100">

    <!-- é é¢é ‚éƒ¨çš„æ§åˆ¶é … (éåˆ—å°å€åŸŸ) -->
    <header class="no-print p-4 bg-white shadow-md sticky top-0">
        <div class="container mx-auto flex justify-between items-center flex-wrap gap-4">
            <div>
                <h1 class="text-xl font-bold text-gray-800">A4 åˆ—å°æ¨¡æ¿ (å«ä¸‹æ‹‰é¸å–®)</h1>
                <p class="text-sm text-gray-500">4 æ¬„ x 5 åˆ—ï¼Œæ¯æ ¼ 4.5x5cmï¼Œä¸Šä¸‹é‚Šè· 2cm</p>
            </div>
            
            <!-- åˆä½µæ§åˆ¶é … -->
            <div class="flex items-center gap-2 flex-wrap">
                <label for="row-to-merge" class="text-sm font-medium text-gray-700">åˆ—è™Ÿ:</label>
                <input type="number" id="row-to-merge" min="1" max="5" class="w-20 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="1-5">
                <label for="cols-to-merge" class="text-sm font-medium text-gray-700">æ¬„è™Ÿ:</label>
                <input type="text" id="cols-to-merge" class="w-28 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="ä¾‹: 1-3 æˆ– 2,3">
                <button id="merge-btn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow transition-transform transform hover:scale-105">åˆä½µ</button>
                <button id="reset-btn" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg shadow transition-transform transform hover:scale-105">é‡è¨­ç‰ˆé¢</button>
                <span id="message-box" class="text-red-500 text-sm font-semibold ml-2"></span>
            </div>

            <button onclick="window.print()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow transition-transform transform hover:scale-105">
                ğŸ–¨ï¸ åˆ—å°æ­¤é é¢
            </button>
        </div>
    </header>

    <!-- A4 é é¢é è¦½å®¹å™¨ -->
    <main>
        <div id="page" class="page-container">
            <div id="grid" class="grid-container">
                <!-- JavaScript æœƒè‡ªå‹•ç”Ÿæˆ 20 å€‹å¯ç·¨è¼¯çš„å„²å­˜æ ¼ -->
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const gridContainer = document.getElementById('grid');
            const mergeBtn = document.getElementById('merge-btn');
            const resetBtn = document.getElementById('reset-btn');
            const rowInput = document.getElementById('row-to-merge');
            const colInput = document.getElementById('cols-to-merge');
            const messageBox = document.getElementById('message-box');
            const totalCells = 20;
            const cols = 4;

            // *** åœ¨é€™è£¡ä¿®æ”¹æˆ–æ–°å¢äººå“¡åå–® ***
            const personnel = ["æ‰€é•·", "å³æ·µæ–‡", "å¼µçš“ç¿”", "æ—ç¾©å‚‘", "é™³ç…Œå¥‡", "æ¥Šç«‹ç¾š", "é™³å½¥å®", "èŠç¾ç²", "æ¢è€€å…ƒ"];

            // é¡¯ç¤ºè¨Šæ¯ä¸¦åœ¨å¹¾ç§’å¾Œæ·¡å‡º
            function showMessage(text, isError = true) {
                messageBox.textContent = text;
                messageBox.className = isError ? 'text-red-500 text-sm font-semibold ml-2' : 'text-green-500 text-sm font-semibold ml-2';
                setTimeout(() => {
                    messageBox.textContent = '';
                }, 3000);
            }

            // ç”¢ç”Ÿåˆå§‹ç¶²æ ¼
            function createGrid() {
                gridContainer.innerHTML = ''; // æ¸…ç©ºç¾æœ‰ç¶²æ ¼
                for (let i = 1; i <= totalCells; i++) {
                    const cell = document.createElement('div');
                    cell.classList.add('grid-cell');
                    cell.id = `cell-${i}`;

                    // --- å»ºç«‹æ ¼å­å…§çš„çµæ§‹ ---
                    const headerDiv = document.createElement('div');
                    headerDiv.classList.add('cell-header');
                    
                    const toSpan = document.createElement('span');
                    toSpan.textContent = 'Toï¼š';

                    // å»ºç«‹ä¸‹æ‹‰é¸å–® (è¢å¹•ä¸Šé¡¯ç¤º)
                    const selectEl = document.createElement('select');
                    selectEl.classList.add('personnel-select', 'no-print');
                    
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = 'è«‹é¸æ“‡';
                    selectEl.appendChild(defaultOption);

                    personnel.forEach(name => {
                        const option = document.createElement('option');
                        option.value = name;
                        option.textContent = name;
                        selectEl.appendChild(option);
                    });

                    // å»ºç«‹åˆ—å°æ™‚é¡¯ç¤ºçš„å§“å Span
                    const printNameSpan = document.createElement('span');
                    printNameSpan.classList.add('print-only-name');
                    printNameSpan.textContent = ' '; // é è¨­ç‚ºç©ºç™½ï¼Œè®“åº•ç·šé¡¯ç¤º

                    // å»ºç«‹å¯ç·¨è¼¯å…§å®¹å€åŸŸ
                    const editableDiv = document.createElement('div');
                    editableDiv.classList.add('editable-content');
                    editableDiv.contentEditable = 'true';

                    // ç›£è½ä¸‹æ‹‰é¸å–®çš„è®ŠåŒ–ï¼Œæ›´æ–°åˆ—å°ç”¨çš„ Span
                    selectEl.addEventListener('change', (e) => {
                        const selectedValue = e.target.value;
                        printNameSpan.textContent = selectedValue || ' '; // å¦‚æœæ²’é¸ï¼Œå°±é¡¯ç¤ºç©ºç™½
                    });

                    headerDiv.appendChild(toSpan);
                    headerDiv.appendChild(selectEl);
                    headerDiv.appendChild(printNameSpan);
                    cell.appendChild(headerDiv);
                    cell.appendChild(editableDiv);
                    
                    gridContainer.appendChild(cell);
                }
            }

            // è§£æä¸¦é©—è­‰æ¬„ä½è¼¸å…¥å­—ä¸²
            function parseAndValidateColumns(str) {
                const columns = new Set();
                if (!str || !str.trim()) return null;

                const parts = str.split(',');
                for (const part of parts) {
                    const trimmedPart = part.trim();
                    if (trimmedPart.includes('-')) {
                        const [start, end] = trimmedPart.split('-').map(Number);
                        if (isNaN(start) || isNaN(end) || start < 1 || end > cols || start >= end) return null;
                        for (let i = start; i <= end; i++) columns.add(i);
                    } else {
                        const num = Number(trimmedPart);
                        if (isNaN(num) || num < 1 || num > cols) return null;
                        columns.add(num);
                    }
                }
                return Array.from(columns).sort((a, b) => a - b);
            }

            // åˆä½µæŒ‡å®šåˆ—çš„æŒ‡å®šæ¬„ä½
            function mergeRow() {
                const row = parseInt(rowInput.value);
                if (isNaN(row) || row < 1 || row > 5) {
                    showMessage('è«‹è¼¸å…¥æœ‰æ•ˆçš„åˆ—è™Ÿ (1-5)');
                    return;
                }

                const colStr = colInput.value;
                const parsedCols = parseAndValidateColumns(colStr);

                if (!parsedCols || parsedCols.length === 0) {
                    showMessage('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ¬„è™Ÿ (ä¾‹: 1-3 æˆ– 2,3)');
                    return;
                }

                const isContiguous = parsedCols.length < 2 || (parsedCols[parsedCols.length - 1] - parsedCols[0] + 1 === parsedCols.length);
                if (!isContiguous) {
                    showMessage('åˆä½µå¤±æ•—ï¼šåƒ…èƒ½åˆä½µé€£çºŒçš„æ¬„ä½');
                    return;
                }
                
                const allCells = Array.from(gridContainer.children);
                const rowStartIndex = (row - 1) * cols;

                for (let i = 0; i < cols; i++) {
                    const cell = allCells[rowStartIndex + i];
                    if (cell) {
                        cell.style.display = '';
                        cell.style.gridColumn = '';
                        cell.classList.remove('merged-cell');
                    }
                }

                if (parsedCols.length > 1) {
                    const startCol = parsedCols[0];
                    const spanCount = parsedCols.length;
                    const startCellIndex = rowStartIndex + startCol - 1;
                    
                    const startCell = allCells[startCellIndex];
                    if (startCell) {
                        startCell.classList.add('merged-cell');
                        startCell.style.gridColumn = `span ${spanCount}`;

                        for (let i = 1; i < spanCount; i++) {
                            const cellToHide = allCells[startCellIndex + i];
                            if (cellToHide) cellToHide.style.display = 'none';
                        }
                    }
                }
                
                showMessage(`ç¬¬ ${row} åˆ—å·²æ›´æ–°`, false);
            }

            // é‡è¨­æ•´å€‹ç¶²æ ¼ç‰ˆé¢
            function resetGrid() {
                createGrid();
                showMessage('ç‰ˆé¢å·²é‡è¨­', false);
            }

            // ç¶å®šäº‹ä»¶ç›£è½å™¨
            mergeBtn.addEventListener('click', mergeRow);
            resetBtn.addEventListener('click', resetGrid);

            // åˆå§‹è¼‰å…¥
            createGrid();
        });
    </script>

</body>
</html>


